\documentclass[11pt,oneside] {article}
\usepackage{float}
\usepackage{html}

\setlength {\textheight} {22cm}
\setlength {\textwidth} {16cm}
\setlength {\oddsidemargin} {0cm}
\setlength {\evensidemargin} {0cm}

\begin{document}
\title{\textbf{Stellarium Developer guide} \\{v 0.1}}
\author{Fabien Ch\'ereau}

\maketitle

\begin{abstract}
This document is aimed at giving a global vision on the organization of the program source code.
\end{abstract}

\section{Introduction}
Stellarium is almost totally designed in an object oriented way. Its source code is thus quite easy to understand and is well subdivided.
The interface with the OS is done using the SDL library which has proven to be powerfull, truly multiplateform and fast.
Project managment is done using sourceforge.net services for cvs hosting, bug tracking, forums etc.. Globally, everything usefull for the project is available at the main project page \htmladdnormallink{http://sourceforge.net/projects/stellarium/}{http://sourceforge.net/projects/stellarium/}.

\section{I want to contribute in developing stellarium. How to start?}
First of all, as stellarium is mainly programmed in C++ you will need some knowledge in object oriented programming.
You will then need to use the GNU development tools and utilities that are required for working on free projects.

Stellarium source code is stored on sourceforge.net server using cvs (concurent version system). This enable everybody to download the last changes in the sources. The cvs version of stellarium is usually on development and might not work at all.


Here are the first steps to start working on the sourcecode : (see detailed instructions from \htmladdnormallink{sourceforge cvs page}{http://sourceforge.net/cvs/?group\_id=48857})
In the stellarium cvs repository, there is only one module called "stellarium"
containing all the project files. So, to get the files as anonymous developer, just type (as explained) :

{\tt cvs -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/stellarium login}

and type {\tt enter} when a password is required.

{\tt cvs -z3 -d:pserver:anonymous@cvs.sourceforge.net:/cvsroot/stellarium co stellarium}

(co = checkout)
And normally all the project files should be downloaded in a new {\tt stellarium/} directory.
In this directory you will find the script {\tt autogen.sh} that you need to execute in
order to run the automake/autoconf things.
After that you can launch the {\tt ./configure} script which will analyze your system.
If everything goes fine, the command {\tt make} should then compile all the sourcecode.

You can now try to launch the local version by typing {\tt ./src/stellarium}

Here you are!

You can now have a look at the {\tt src/} directory where you will find the source files described below.
Edit whatever you want in it and when your new great feature is done you will need to share it with the community of stellarium developers.

At this point, an official developer just have to type {\tt cvs commit} to update the repository version. But as you are not an official developer (yet!) you will need to create a patch file which will contain all the changes you did on the source code.

{\tt cd directory-you-want-to-diff}

{\tt cvs -z3 diff -u > mypatch.diff}

You can now submit mypatch.diff on the sourceforge stellarium page in the \htmladdnormallink{patches section}{http://sourceforge.net/tracker/?group_id=48857&atid=454375} with a clear comment on what is the patch doing.

The project administrator will then have a look at it and decide whether the patch is accepted or rejected for integration into stellarium.

\section{Main files description}
All the files starting with a s\_ are "theoricaly" independent of the main program. They manage textures, font and user interface and could be re-used for any other openGL application.

\begin{description}
	\item[stel\_sdl.h/cpp :] Class handling sdl functions. It contains the main loop intercepting all the system events and send them to the core.
	\item[stel\_core.h/cpp :] Main stellarium class. It manages all the main components of the program and stores all the attributes of the program.
The 3 main functions of the program are methods of his class. They are :
	\begin{description}
		\item[init() :] Initialize the core of the program : creates all the main objects and initialize them.
		\item[update() :] Update all the objects : time, viewing, planet positions, moves, user interface etc..
		\item[draw() :] Draw everything on the openGL buffer.
	\end{description}
update() and draw() are called in the main loop at each iteration.
The stel\_core class manages all the configuration file reading and saving.

	\item[navigator.h/cpp :]
Manage all the astronomical navigational functions. Used for frames conversions.

	\item[observator.h/cpp :]
Manage all the information relative to an observator (position, locales etc..)

	\item[projector.h/cpp and fisheye\_projector.h/cpp :]
One of the class i'm proud of :). Manage various kind of projections : perspective, fisheye.

	\item[init\_parser.h/cpp :]
Wrapper c++ class for the c library initparser.

	\item[stel\_object.h/cpp :]
Abstract mother class for all astronomical objects stars, planets and nebula.

	\item[hip\_star.h/cpp and hip\_star\_mgr.h/cpp :]
Manage stars from the hipparcos catalog and stars collections respectively.

	\item[grid.h/cpp :]
Used for optimization with grid structure while displaying the hipparcos star catalog.

	\item[planet.h/cpp and solarsystem.h/cpp :]
Manage any body which has a defined position inside the solar system.

	\item[nebula.h/cpp and nebula\_mgr.h/cpp :]
Manage nebula and nebula collection repectively.

	\item[constellation.h/cpp and constellation\_mgr.h/cpp :]
Manage constellations and collection of constellations respectively.

	\item[landscape.h/cpp :]
Manage landscapes.

	\item[stel\_atmosphere.h/cpp :]
Manage atmosphere rendering. Uses the classes sky\_bright and sky\_light to compute sky color and brightness and display it.

	\item[tone\_reproductor.h/cpp :]
The class which simulate the eye adaptation to luminance.

	\item[draw.h/cpp :]
Groups some classes used to draw various objects of the program : milky way, grids, astronomical lines, cardinal points.

	\item[stel\_ui.h/cpp :] manage the user interface for stellarium using s\_gui/s\_tui widgets.

	\item[s\_gui.h/cpp :]
All the Graphical User Interface (gui) classes. Used in the desktop version only.

	\item[s\_tui.h/cpp :]
All the Text User Interface (tui) classes. Used in planetarium version only.

	\item[s\_font.h/cpp :]
Manage fonts. The font in stellarium are not bitmap but taken from a real grey level texture.

	\item[s\_texture.h/cpp :]
Class which manages textures. Currently uses glpng library to handle png files.

	\item[callback.h/cpp :] Handfull class made by the boost library team used to handle callbacks. It's used for the widgets.
\end{description}

\section{External libraries (directories in src/)}
\begin{description}
	\item[glpng :] create openGL textures from .png files. Written in C and used thru the s\_texture class.
	\item[iniparser :] config files parsing. Used thru the wrapper class init\_parser.
	\item[stellastro :] miscelaneous astronomical functions.
	\item[stellplanet :] compute heliocentric positions of solar system planets.
\end{description}
\end{document}
